import geopandas as gpd
import pandas as pd
from datetime import datetime
import os
import json
import logging

# Configuration simple du logger
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# -------- Fonctions utilitaires ------------

def show_progress(current_step, total_steps, message):
    percent = int(100 * current_step / total_steps)
    now = datetime.now().strftime("%d/%m/%Y || %H:%M:%S")
    print(f"{now} || [{percent:3d}%] {message}")

def charger_json(chemin):
    try:
        with open(chemin, 'r', encoding='utf-8') as f:
            data = json.load(f)
        logger.info(f"Chargé JSON : {chemin}")
        return data
    except Exception as e:
        logger.error(f"Erreur chargement JSON {chemin} : {e}")
        return None

def preprocess_gdf(gdf, epsg):
    gdf = gdf.to_crs(epsg=epsg)
    gdf['DATE'] = pd.to_datetime(gdf['DATE'], errors='coerce')
    return gdf

def classification_marree(df_marees):
    mean = df_marees['value'].mean()
    std = df_marees['value'].std()
    def classer_marree(val):
        if val < mean - std:
            return 'Marée Basse'
        elif val > mean + std:
            return 'Marée Haute'
        else:
            return 'Marée Intermédiaire'
    df_marees['classe_marree'] = df_marees['value'].apply(classer_marree)
    return df_marees

def merge_marrees(gdf_fusion, df_marees):
    gdf_fusion = gdf_fusion.sort_values('DATE')
    df_marees = df_marees.sort_values('timestamp')

    # Conversion de la format de la date <M8[ms]  en format de dtype <M8[ns]

    gdf_fusion['DATE'] = pd.to_datetime(gdf_fusion['DATE'], errors='coerce').astype('datetime64[ns]')
    df_marees['timestamp'] = pd.to_datetime(df_marees['timestamp'], errors='coerce').astype('datetime64[ns]')

    gdf_merged = pd.merge_asof(
        gdf_fusion,
        df_marees,
        left_on='DATE',
        right_on='timestamp',
        direction='backward'
    )
    gdf_merged['value'] = gdf_merged['value'].fillna(0)
    gdf_merged['classe_marree'] = gdf_merged['classe_marree'].fillna('inconnue')
    gdf_merged = gdf_merged.rename(columns={'value': 'Valeur_marée', 'classe_marree': 'Classe_marée'})
    gdf_merged.drop(columns=['timestamp'], inplace=True)
    return gdf_merged

def merge_candhis(gdf_fusion, candhis_csv_path):
    """
    Effectue la jointure asof entre gdf_fusion et les données CANDHIS contenues dans le fichier CSV.

    Parameters
    ----------
    gdf_fusion : GeoDataFrame trié par colonne 'DATE'
    candhis_csv_path : str, chemin vers le fichier candhis_fusion.csv

    Returns
    -------
    GeoDataFrame enrichi de la colonne 'HM0' issue de la jointure.
    """
    df_candhis = pd.read_csv(candhis_csv_path, sep=",")
    df_candhis['Date'] = pd.to_datetime(df_candhis['Date'], errors='coerce')
    df_candhis['HM0'] = pd.to_numeric(df_candhis['HM0'], errors='coerce')

    df_candhis = df_candhis.sort_values('Date')
    gdf_fusion = gdf_fusion.sort_values('DATE')

    gdf_merged = pd.merge_asof(
        gdf_fusion,
        df_candhis[['Date', 'HM0']],
        left_on='DATE',
        right_on='Date',
        direction='backward'
    )
    gdf_merged['HM0'] = gdf_merged['HM0'].fillna(0)

    if 'Date' in gdf_merged.columns:
        gdf_merged = gdf_merged.drop(columns=['Date'])

    return gdf_merged


def get_output_path(input_path, suffix="_Corriger"):
    base, ext = os.path.splitext(input_path)
    return f"{base}{suffix}{ext}"

# ------------- Traitement principal -------------

def main():
    total_steps = 10
    epsg_reunion = 2975

    traitements = [
        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/MNDWI/fusion_trait_de_cote_2015&2017.shp",
            "dates_a_supprimer": {
                8235: ['2016-12-13', '2017-06-01'],
                8236: ['2017-06-01', '2016-07-26', '2016-10-04', '2016-07-06', '2016-04-17', '2016-06-26', '2017-06-11'],
                8237: ['2016-10-04', '2016-07-26'],
                8238: ['2017-02-11', '2016-07-26'],
                8240: ['2016-07-06', '2017-02-11'],
                8241: ['2016-06-26'],
                8244: ['2016-12-23'],
                8248: ['2017-02-11'],
                8250: ['2017-06-21'],
                8251: ['2016-05-27', '2017-06-21', '2016-07-26'],
                8252: ['2016-07-26', '2017-06-26', '2016-05-27', '2017-06-01', '2017-06-21', '2017-02-11', '2016-10-14', '2017-04-12'],
                8253: ['2017-06-21', '2017-05-22', '2016-07-06', '2016-12-13', '2016-07-26', '2017-02-11', '2017-03-03', '2017-05-27', '2016-12-23', '2017-06-01', '2016-05-27', '2017-04-12', '2015-11-29', '2016-10-14', '2017-06-11'],
                8255: ['2017-06-21', '2016-12-13', '2017-05-22'],
                8256: ['2016-12-23'],
                8257: ['2017-02-11', '2017-06-21', '2016-04-17', '2016-05-27', '2017-06-11', '2016-06-26', '2016-07-06', '2017-06-26', '2016-07-26', '2016-05-27', '2017-06-01', '2016-12-13', '2016-12-23'],
                8258: ['2017-06-11', '2016-07-06', '2016-07-26', '2016-05-27', '2016-06-26', '2016-06-16', '2016-04-17', '2017-06-21'],
                8259: ['2015-10-20'],
                8263: ['2015-10-20', '2016-04-17', '2016-04-07'],
                8265: ['2016-04-17', '2017-06-11', '2016-07-26', '2017-06-26', '2016-07-07', '2016-04-07', '2016-06-06'],
                8269: ['2016-10-14', '2017-05-12', '2015-11-29'],
                8270: ['2015-11-29'],
                8274: ['2017-03-03', '2016-12-23', '2017-02-11'],
                8275: ['2017-03-03', '2015-11-29', '2016-07-06', '2016-10-14', '2017-05-12', '2016-12-13', '2016-07-16'],
                8276: ['2017-03-03', '2017-05-12', '2016-10-14', '2016-06-16'],
                8228: ['2017-04-12', '2017-05-12', '2016-07-16', '2017-05-22', '2016-07-26', '2017-02-11', '2016-06-06'],
                8229: ['2017-04-12', '2016-07-26', '2016-06-06', '2017-06-21', '2016-05-27', '2017-06-11', '2016-10-04', '2016-07-06', '2017-05-12', '2015-10-20'],
                8230: ['2016-07-26', '2016-05-27', '2016-08-25', '2017-03-03', '2016-06-26', '2016-10-14', '2016-07-16', '2017-04-12', '2017-04-12', '2015-10-20', '2016-07-16'],
                8231: ['2017-06-21', '2016-07-16'],
                8282: ['2017-02-11', '2016-06-06', '2016-12-23', '2016-07-26']
            }
        },
        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/MNDWI/fusion_trait_de_cote_2017&2018.shp",
            "dates_a_supprimer": {
                8223: ['2018-02-01', '2017-11-03', '2017-09-09'],
                8225: ['2017-11-03', '2017-07-11'],
                8228: ['2018-04-12', '2018-06-01', '2018-04-02', '2018-03-13', '2018-01-02', '2018-06-16', '2017-11-03', '2018-05-17', '2018-03-28', '2017-08-05'],
                8229: ['2018-06-01', '2017-11-18', '2018-05-17', '2018-06-26', '2018-02-01', '2017-09-24', '2017-07-21', '2017-08-15', '2018-06-26', '2017-09-04', '2018-01-22', '2018-02-11', '2017-05-22'],
                8230: ['2018-05-17', '2018-06-16', '2017-07-21', '2017-09-04', '2017-07-21', '2018-06-26'],
                8231: ['2017-09-09', '2017-11-18', '2018-06-16', '2018-04-07', '2017-11-03', '2018-04-12', '2017-07-06'],
                8236: ['2018-03-28', '2018-03-13', '2018-02-01', '2018-04-07'],
                8237: ['2017-07-21'],
                8238: ['2018-05-17'],
                8241: ['2017-11-18', '2017-11-03', '2018-06-26'],
                8243: ['2017-11-18'],
                8244: ['2018-05-17'],
                8245: ['2018-05-17'],
                8248: ['2018-06-26', '2017-11-18'],
                8249: ['2017-11-18'],
                8250: ['2017-07-11', '2017-08-10', '2017-11-18'],
                8251: ['2017-07-11'],
                8252: ['2017-12-08', '2017-11-28', '2018-04-02'],
                8253: ['2018-06-26', '2017-09-09', '2017-11-28', '2017-11-03', '2018-06-16', '2018-04-02', '2017-07-21', '2017-09-24', '2017-11-18', '2018-03-13', '2017-07-11', '2018-01-02', '2018-06-11', '2017-08-10'],
                8254: ['2017-08-10', '2017-08-15'],
                8255: ['2018-06-11', '2017-07-21'],
                8256: ['2017-08-10'],
                8257: ['2018-06-16', '2017-08-10', '2017-08-15', '2017-07-21', '2017-09-24', '2018-01-02', '2017-11-03', '2018-06-21', '2017-09-04', '2018-06-21', '2017-09-04', '2018-03-28', '2017-11-18', '2017-08-05', '2018-05-17', '2018-06-11', '2018-04-07'],
                8258: ['2017-08-15', '2017-09-04', '2017-09-24'],
                8259: ['2017-08-15', '2017-09-24'],
                8260: ['2017-11-03', '2017-08-10'],
                8262: ['2017-11-28', '2017-08-10', '2017-07-11'],
                8263: ['2018-04-07', '2017-07-21', '2018-03-13', '2017-09-24', '2018-04-07', '2017-11-03', '2018-03-28'],
                8264: ['2018-01-02', '2017-11-03', '2018-05-17'],
                8265: ['2017-08-25', '2017-08-15', '2017-09-09', '2018-04-02', '2018-06-26', '2017-07-11'],
                8269: ['2017-11-03'],
                8270: ['2017-11-18'],
                8274: ['2017-11-03', '2018-01-02', '2017-12-08'],
                8275: ['2017-07-21', '2017-10-09', '2018-05-17', '2017-07-11', '2018-01-02', '2017-11-03', '2017-11-28'],
                8276: ['2018-02-01', '2017-11-18', '2017-11-03'],
                8282: ['2017-07-06', '2018-01-22', '2017-12-08', '2017-08-15', '2017-10-09', '2018-06-26', '2019-09-04', '2018-02-11', '2018-02-01', '2017-07-21']
            }
        },
        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/MNDWI/fusion_trait_de_cote_2018&2019.shp",
            "dates_a_supprimer": {
                8223: ['2018-09-29'],
                8228: ['2019-03-13', '2018-11-03', '2018-12-18', '2019-04-27', '2019-03-28', '2018-12-13', '2019-02-11', '2019-03-28', '2018-11-28', '2018-07-16', '2018-11-08', '2019-03-03', '2019-05-02'],
                8229: ['2019-03-28', '2019-05-02', '2018-07-16', '2018-11-03', '2018-07-11', '2019-05-27', '2018-11-28', '2018-07-11', '2018-07-06', '2018-08-05', '2019-01-12', '2018-02-11', '2019-02-11'],
                8230: ['2018-12-28', '2019-06-01', '2018-08-05', '2019-03-28', '2019-06-16', '2019-05-27', '2018-07-06', '2019-05-27',  '2018-07-11', '2019-06-21'],
                8231: ['2019-03-28', '2019-02-21', '2019-04-27', '2018-12-08', '2018-07-31', '2019-02-21'],
                8235: ['2019-03-03', '2018-12-18', '2018-12-28'],
                8236: ['2019-03-03', '2019-02-11', '2018-12-13', '2019-03-28', '2018-12-03', '2019-06-16', '2018-12-08', '2019-06-11', '2018-08-25', '2018-06-26'],
                8237: ['2019-03-28', '2019-06-11', '2018-10-14'],
                8238: ['2018-12-03'],
                8239: ['2018-12-03'],
                8240: ['2018-07-31'],
                8243: ['2018-12-03', '2018-07-16', '2019-04-27'],
                8244: ['2018-12-03', '2018-07-16', '2019-03-13', '2018-12-13', '2018-08-10', '2018-08-05'],
                8245: ['2018-07-16'],
                8246: ['2019-06-11', '2019-03-28'],
                8250: ['2018-07-16', '2019-06-11'],
                8251: ['2018-07-16', '2019-03-28', '2018-12-18'],
                8252: ['2018-07-06', '2019-03-28', '2019-03-03', '2018-12-28'],
                8253: ['2018-12-18', '2018-11-28', '2018-07-06', '2018-11-08', '2019-06-11', '2018-07-01', '2018-07-16', '2019-05-02', '2018-07-11', '2019-03-28', '2018-10-14'],
                8254: ['2019-06-21', '2019-06-11 '],
                8255: ['2018-11-03'],
                8256: ['2018-08-10', '2018-07-11', '2018-12-03', '2019-06-11'],
                8257: ['2019-04-27', '2019-06-11', '2018-08-30', '2018-08-25', '2018-09-19', '2018-09-29', '2018-07-06', '2018-07-11', '2019-03-28', '2018-11-28', '2019-02-11', '2018-12-03', '2018-07-16', '2019-03-03', '2018-08-10', '2018-12-28', '2018-12-08', '2018-11-08'],
                8258: ['2019-06-11', '2018-12-03', '2018-11-08', '2018-08-30', '2018-09-19', '2018-07-06'],
                8259: ['2019-04-27', '2018-07-16', '2019-03-03', '2018-12-03'],
                8260: ['2018-12-03'],
                8262: ['2018-12-03', '2018-12-13', '2019-02-21', '2018-08-10', '2018-07-16', '2019-03-03', '2019-11-08', '2018-08-10', '2018-08-05', '2018-07-11', '2019-03-13'],
                8263: ['2018-12-03', '2018-08-10', '2019-05-12', '2018-11-08', '2018-11-28', '2019-02-11', '2018-09-19', '2018-08-25'],
                8264: ['2018-11-28', '2018-10-14', '2018-11-08', '2019-03-03'],
                8265: ['2019-06-21', '2018-08-10', '2018-07-06', '2019-06-21', '2018-07-06', '2018-08-05', '2018-07-31', '2019-03-03'],
                8269: ['2018-12-18', '2019-05-12', '2019-05-02', '2018-12-13', '2018-11-28', '2018-12-03', '2019-02-21', '2019-05-12', '2019-03-28'],
                8270: ['2019-02-21', '2019-03-13', '2018-12-03'],
                8273: ['2018-11-28', '2019-02-21'],
                8274: ['2019-03-28', '2018-08-05', '2018-08-25', '2018-12-13', '2018-11-03', '2018-11-28', '2018-12-03', '2019-02-21'],
                8275: ['2019-03-28', '2019-02-21', '2018-12-03', '2018-11-28', '2019-02-11', '2019-06-11'],
                8276: ['2019-02-21', '2018-11-28', '2019-02-11', '2019-06-11'],
                8282: ['2019-06-16', '2019-03-28', '2018-08-05', '2018-07-06', '2018-11-28', '2018-12-13', '2019-01-12', '2018-07-06']
            }
        },
        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/MNDWI/fusion_trait_de_cote_2019&2020.shp",
            "dates_a_supprimer": {
                8223: ['2019-12-03', '2020-04-16'],
                8228: ['2020-06-30', '2020-03-22', '2019-08-15', '2019-09-29', '2020-04-16', '2019-08-10', '2020-01-12', '2019-12-13', '2020-06-15', '2019-10-04', '2019-08-10', '2019-10-04'],
                8229: ['2020-05-31', '2019-10-04', '2020-05-06', '2020-04-01', '2019-11-03', '2019-07-06', '2019-07-11', '2020-04-06', '2019-07-11', '2020-06-15', '2019-11-08', '2019-12-03', '2019-08-15'],
                8230: ['2019-09-29', '2020-05-31', '2019-08-05', '2020-06-15', '2020-04-01', '2019-07-11', '2019-07-01'],
                8231: ['2019-08-15', '2020-01-12', '2020-04-01', '2019-07-11', '2019-08-05'],
                8235: ['2020-06-15', '2019-10-29', '2020-05-31', '2020-04-01', '2019-12-13', '2019-12-03', '2019-10-14', '2020-05-31', '2020-04-16', '2020-04-06'],
                8236: ['2020-04-06', '2019-10-29', '2019-10-14', '2020-04-01', '2019-12-13', '2020-04-01', '2019-10-29'],
                8237: ['2019-10-29'],
                8241: ['2019-12-18'],
                8243: ['2019-12-18'],
                8244: ['2019-12-03', '2019-11-28'],
                8246: ['2019-07-01'],
                8250: ['2019-12-18', '2020-06-15'],
                8251: ['2019-11-18', '2019-07-01', '2019-10-04', '2019-11-08'],
                8252: ['2019-12-18', '2019-11-28', '2020-04-16', '2020-04-06', '2019-10-14', '2019-12-18'],
                8253: ['2019-07-01', '2020-01-12', '2019-10-29', '2019-11-03', '2019-07-11', '2019-11-28', '2020-04-26', '2019-10-04', '2019-11-08', '2019-09-29', '2020-06-15', '2020-01-27'],
                8254: ['2019-12-18', '2020-06-30', '2019-12-13'],
                8255: ['2019-12-18', '2019-09-29'],
                8256: ['2019-09-29', '2020-06-30'],
                8257: ['2020-03-22', '2019-11-08', '2019-10-14', '2020-06-15', '2019-09-29', '2020-04-16', '2019-08-10', '2020-05-31', '2020-01-12', '2020-03-22', '2020-06-30', '2019-12-18', '2019-10-04'],
                8258: ['2019-12-19', '2020-04-06', '2019-07-01', '2019-10-14', '2019-12-13'],
                8259: ['2019-12-18', '2019-12-13', '2020-01-12', '2019-10-29'],
                8263: ['2019-11-03', '2019-10-29', '2019-08-05'],
                8264: ['2019-10-04', '2019-11-03', '2020-04-06'],
                8265: ['2019-08-05', '2020-04-16', '2020-04-06', '2020-06-15', '2020-02-01', '2019-08-10', '2019-07-01', '2019-07-06'],
                8269: ['2020-01-12', '2019-07-01', '2019-09-29'],
                8270: ['2020-04-06', '2020-01-12', '2019-12-18'],
                8273: ['2020-01-12', '2019-12-03'],
                8274: ['2020-01-12', '2019-12-03', '2019-11-03', '2019-10-14', '2019-07-11', '2019-11-28', '2019-10-29'],
                8275: ['2019-07-06', '2019-07-11', '2019-07-06', '2019-08-15', '2019-07-06', '2019-10-24', '2019-11-08', '2019-12-18', '2019-08-15', '2019-10-29'],
                8276: ['2019-10-29', '2019-08-05', '2020-05-06', '2020-03-22'],
                8282: ['2020-04-16', '2020-04-01', '2020-04-16', '2020-04-06', '2019-08-15', '2019-11-08', '2019-07-11', '2019-07-06', '2019-08-10', '2020-06-30', '2019-12-18', '2019-10-04', '2020-05-06']
            }
        },
        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/MNDWI/fusion_trait_de_cote_2020&2021.shp",
            "dates_a_supprimer": {
                8223: ['2021-01-16'],
                8225: ['2021-06-30', '2021-03-22', '2021-01-16', '2021-06-20'],
                8226: ['2020-08-29', '2021-06-20', '2021-02-20', '2021-05-11'],
                8228: ['2020-08-24', '2021-01-26', '2021-03-12', '2021-01-16', '2021-03-17', '2020-12-22', '2021-01-31', '2021-02-20'],
                8229: ['2021-03-17', '2020-09-23', '2021-02-20', '2021-02-25', '2021-02-20', '2021-06-30', '2020-08-29', '2021-01-01', '2020-09-08', '2020-12-12', '2021-03-02', '2020-07-10', '2021-05-26', '2021-03-17', '2021-02-25', '2020-10-18', '2020-12-22', '2021-03-17', '2020-08-24', '2021-02-20'],
                8230: ['2021-06-25', '2020-11-02', '2020-09-08', '2020-09-08', '2021-06-30', '2020-12-22', '2020-08-19', '2021-03-12', '2021-01-16'],
                8235: ['2020-12-07', '2021-06-20'],
                8236: ['2020-08-29', '2020-12-22', '2021-05-31', '2020-12-22', '2020-08-29', '2020-08-19', '2021-06-29', '2021-06-30', '2021-06-10', '2020-07-10'],
                8237: ['2020-07-10', '2021-03-17', '2021-02-15'],
                8239: ['2020-07-10', '2021-06-20'],
                8241: ['2020-07-10', '2021-06-20'],
                8242: ['2021-01-16'],
                8243: ['2020-07-10', '2021-06-10'],
                8249: ['2021-06-20'],
                8251: ['2020-08-19'],
                8252: ['2020-08-19', '2021-02-20', '2021-03-12', '2021-02-10'],
                8253: ['2020-11-02', '2021-05-21', '2021-06-10', '2021-02-25', '2020-12-07', '2020-08-19',  '2020-10-08', '2021-06-20', '2021-01-31', '2020-11-02', '2021-05-01', '2021-02-20', '2020-10-08', '2020-07-10'],
                8254: ['2021-01-01', '2020-10-08', '2020-07-10', '2020-08-19', '2020-12-12'],
                8255: ['2020-07-10', '2021-03-12', '2020-11-02', '2020-12-12', '2020-08-19'],
                8256: ['2020-12-07', '2021-03-12', '2020-11-02'],
                8257: ['2021-02-25', '2021-05-21', '2021-03-02', '2021-01-01', '2021-03-17', '2020-10-18', '2020-12-22', '2020-10-08', '2020-08-19', '2020-08-29', '2021-02-25', '2021-05-21'],
                8258: ['2021-03-02', '2021-05-21', '2021-11-17', '2021-08-14', '2022-07-25'],
                8259: ['2021-01-16'],
                8260: ['2021-03-02', '2021-01-31', '2021-03-22', '2021-01-16', '2021-05-21'],
                8261: ['2020-12-07'],
                8262: ['2021-03-12', '2021-04-01', '2021-03-22'],
                8263: ['2021-05-11', '2021-03-02', '2020-10-18', '2020-10-08', '2021-04-01', '2021-03-17', '2020-09-08', '2020-09-23'],
                8264: ['2021-04-01', '2021-05-11'],
                8265: ['2020-12-12', '2021-04-01', '2021-03-22', '2021-06-10'],
                8266: ['2021-03-12', '2021-06-25'],
                8269: ['2020-08-24', '2021-01-01', '2020-10-08', '2021-01-26'],
                8270: ['2021-01-16', '2021-03-02', '2020-08-24', '2021-03-02', '2020-10-08'],
                8273: ['2021-05-21', '2020-07-10'],
                8274: ['2020-07-10', '2021-03-22', '2021-01-26', '2020-12-07', '2021-05-26', '2021-03-17', '2021-06-20', '2020-07-10', '2021-01-16', '2020-08-24'],
                8275: ['2021-01-16', '2021-05-21', '2020-08-24', '2021-03-22', '2020-12-07', '2021-05-26', '2021-01-31', '2021-06-30', '2020-07-10', '2021-06-20', '2021-03-12', '2020-10-08', '2020-11-02', '2021-06-30', '2020-08-19', '2021-04-06', '2021-02-20'],
                8276: ['2020-12-07', '2021-02-20', '2021-04-06', '2020-10-08'],
                8282: ['2021-05-21', '2020-08-29', '2020-12-12', '2021-06-30']
            }
        },
        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/MNDWI/fusion_trait_de_cote_2021&2022.shp",
            "dates_a_supprimer": {
                8235: ['2022-02-10', '2021-07-20', '2021-09-28', '2021-07-15'],
                8236: ['2021-07-20', '2021-07-05', '2021-10-28', '2021-07-15'],
                8237: ['2021-09-18'],
                8240: ['2022-02-10'],
                8241: ['2021-07-20'],
                8244: ['2021-11-17'],
                8245: ['2021-12-17'],
                8248: ['2021-08-14'],
                8251: ['2022-05-06', '2021-07-15'],
                8252: ['2022-03-12', '2022-02-10', '2021-11-17', '2021-09-28', '2021-12-17', '2021-10-23', '2022-06-30'],
                8253: ['2021-07-20', '2022-05-26', '2022-05-06', '2022-05-21', '2022-05-31'],
                8254: ['2022-02-15', '2021-10-18', '2021-11-17', '2021-09-28', '2021-09-08', '2022-06-30', '2021-10-28', '2021-11-07'],
                8256: ['2021-07-15'],
                8257: ['2021-07-20', '2022-02-10', '2022-05-26', '2021-09-28', '2022-01-26', '2021-10-28', '2021-07-15', '2021-08-14', '2021-10-23', '2021-11-17', '2021-09-08'],
                8258: ['2022-05-31', '2021-07-15', '2022-05-21', '2021-11-17', '2021-08-14'],
                8262: ['2021-12-17'],
                8263: ['2022-05-21', '2021-12-17', '2021-11-12', '2022-05-31', '2021-10-18', '2021-07-05', '2021-10-23', '2021-03-12', '2022-03-12', '2021-08-14'],
                8264: ['2022-05-31'],
                8265: ['2021-07-15', '2021-07-05', '2021-11-07', '2022-02-10'],
                8266: ['2022-01-26'],
                8268: ['2021-05-31'],
                8269: ['2021-09-08', '2021-09-18', '2021-11-12', '2021-10-23'],
                8270: ['2021-12-17'],
                8273: ['2021-09-08'],
                8274: ['2021-09-08', '2021-12-17', '2021-09-18'],
                8275: ['2021-12-17', '2022-04-21', '2021-11-12', '2021-11-07', '2022-05-06', '2022-06-05', '2021-08-14'],
                8223: ['2022-03-12', '2022-02-10', '2022-05-21', '2021-08-14'],
                8225: ['2021-11-07'],
                8226: ['2022-06-05'],
                8228: ['2021-10-28', '2021-11-07', '2022-05-26', '2022-03-12', '2022-04-26', '2021-07-15', '2021-07-15', '2022-05-21', '2021-09-08'],
                8229: ['2021-10-18', '2021-11-12', '2021-11-17', '2022-01-26', '2022-04-11', '2022-06-05', '2022-01-26', '2022-04-26', '2022-05-01', '2021-07-05', '2022-02-15', '2021-07-05', '2022-04-11', '2022-05-31', '2022-03-12'],
                8230: ['2022-02-15', '2022-04-11', '2022-05-06', '2021-11-17', '2022-05-26', '2022-04-26', '2021-07-05'],
                8231: ['2022-02-10', '2021-12-17'],
                8232: ['2022-02-10', '2022-03-12'],
                8282: ['2022-03-12', '2021-07-05', '2021-07-20', '2022-06-05', '2022-02-10', '2021-07-15']
            }
        },
        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/MNDWI/fusion_trait_de_cote_2022&2023.shp",
            "dates_a_supprimer": {
                8235: ['2022-12-07', '2023-01-01', '2023-06-10'],
                8236: ['2023-06-10', '2022-12-27', '2022-08-24', '2023-05-11', '2022-08-09'],
                8237: ['2023-01-01'],
                8239: ['2023-05-31', '2023-01-01'],
                8240: ['2023-06-10', '2023-01-01'],
                8241: ['2023-02-25', '2023-05-11', '2022-07-05', '2023-01-01', '2023-06-10', '2022-11-27'],
                8242: ['2022-12-02', '2023-01-01', '2022-12-02'],
                8243: ['2023-01-01', '2023-05-31'],
                8244: ['2023-01-01'],
                8245: ['2023-01-01', '2023-04-21'],
                8246: ['2023-01-01'],
                8247: ['2023-01-01'],
                8248: ['2023-05-31'],
                8250: ['2023-05-31', '2023-01-01'],
                8251: ['2023-01-01', '2022-12-02', '2022-08-09'],
                8252: ['2023-06-10', '2023-05-31', '2022-08-09'],
                8253: ['2023-02-25', '2022-08-09', '2023-06-10', '2022-08-24', '2022-07-25'],
                8255: ['2022-11-17', '2023-05-11', '2023-05-11'],
                8257: ['2022-10-08', '2022-12-27', '2022-11-27', '2023-03-27', '2022-12-07', '2023-06-10', '2022-07-10', '2022-08-24', '2023-03-17', '2023-01-01', '2022-07-05', '2023-02-10'],
                8258: ['2022-07-05', '2022-10-08', '2022-11-27', '2023-03-02', '2022-07-25'],
                8259: ['2023-01-01', '2020-04-21', '2023-06-10'],
                8262: ['2023-03-02'],
                8263: ['2023-03-02', '2022-11-12', '2023-05-21', '2022-12-17', '2022-08-24', '2022-11-17'],
                8265: ['2023-03-02', '2023-01-01', '2022-08-24', '2023-02-10'],
                8266: ['2023-01-01', '2022-07-03', '2022-07-25', '2022-07-05'],
                8268: ['2023-01-01'],
                8269: ['2023-04-16', '2022-09-23', '2023-04-06', '2023-04-06', '2023-02-10', '2023-01-16', '2023-06-30', '2023-03-02'],
                8270: ['2023-03-02', '2023-01-16', '2023-06-30', '2023-01-16', '2023-04-21'],
                8273: ['2023-01-16'],
                8274: ['2022-09-23', '2023-06-30', '2022-07-05', '2023-03-27', '2023-04-06', '2022-10-03', '2023-01-16'],
                8275: ['2022-12-17', '2022-09-23', '2022-10-03', '2023-01-01', '2022-10-08', '2023-04-06', '2023-06-30', '2023-09-08', '2022-08-24'],
                8276: ['2023-01-01', '2022-09-23', '2023-06-30'],
                8223: ['2023-01-01', '2022-10-03'],
                8225: ['2023-01-01'],
                8226: ['2023-01'],
                8228: ['2023-03-02', '2022-09-23', '2022-12-02', '2023-03-27', '2023-04-21', '2022-11-27', '2022-07-05', '2022-11-17', '2022-11-02', '2022-07-05', '2023-02-10'],
                8229: ['2023-02-10', '2023-01-16', '2023-06-30', '2023-04-06', '2023-02-25', '2022-09-23', '2022-08-24', '2022-12-02', '2022-10-03', '2023-01-01', '2022-10-03'],
                8230: ['2022-09-23', '2023-05-21', '2022-11-12', '2023-02-15', '2022-12-02', '2022-10-03', '2022-10-08', '2022-09-23', '2023-01-16', '2022-07-10', '2023-03-02'],
                8231: ['2022-09-23'],
                8282: ['2022-09-23', '2023-04-06', '2023-05-31', '2023-05-21', '2023-03-27', '2022-12-17']
            }
        },
        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/MNDWI/fusion_trait_de_cote_2023&2024.shp",
            "dates_a_supprimer": {
                8235: ['2024-02-15'],
                8236: ['2023-07-30', '2024-02-15'],
                8237: ['2023-07-30', '2024-06-09', '2024-06-24', '2023-08-09'],
                8238: ['2023-12-27'],
                8241: ['2023-07-30', '2024-05-10'],
                8250: ['2023-07-25'],
                8251: ['2023-07-10'],
                8252: ['2023-08-09', '2023-08-14', '2024-02-05', '2024-01-31', '2023-07-25'],
                8253: ['2023-08-14', '2023-08-24', '2023-07-25', '2024-01-11', '2024-01-31', '2024-06-24', '2023-08-09', '2024-06-19', '2023-07-05', '2024-05-10', '2023-12-27', '2023-07-10', '2023-07-30'],
                8254: ['2023-07-25', '2024-06-09'],
                8255: ['2023-07-05', '2023-07-10', '2023-07-25', '2024-05-10', '2024-06-24', '2023-12-22'],
                8256: ['2023-12-27', '2023-06-09'],
                8257: ['2023-07-25', '2024-01-11', '2023-12-27', '2023-08-09', '2024-06-24', '2023-07-30', '2024-06-09', '2023-09-23', '2024-05-10', '2023-08-14', '2024-04-25', '2023-12-22', '2023-07-10', '2024-06-09', '2024-01-31'],
                8258: ['2024-05-10', '2024-06-24', '2023-08-09', '2023-08-14', '2024-06-09'],
                8259: ['2023-08-14', '2023-12-27'],
                8260: ['2024-01-11', '2024-05-05', '2023-12-27'],
                8261: ['2023-10-18'],
                8263: ['2024-01-31', '2023-08-24', '2023-12-22', '2023-10-08', '2023-07-30', '2023-07-25', '2023-09-08', '2024-03-21', '2024-03-01'],
                8264: ['2023-08-24', '2023-10-23'],
                8265: ['2023-07-10', '2024-06-24', '2023-07-30', '2023-08-24', '2024-06-09', '2023-08-14'],
                8266: ['2023-07-30', '2023-08-19', '2023-12-17'],
                8268: ['2023-12-27'],
                8269: ['2024-05-05', '2023-12-17', '2024-02-05', '2024-06-19', '2023-09-23'],
                8270: ['2023-12-17', '2024-02-05'],
                8274: ['2023-10-08', '2023-10-18', '2024-01-31', '2023-08-24'],
                8275: ['2023-10-18', '2023-08-19', '2023-07-30', '2024-05-05', '2023-12-22', '2023-10-08', '2023-07-30', '2023-09-08'],
                8276: ['2023-08-19', '2023-12-17'],
                8223: ['2024-02-05', '2024-04-25'],
                8225: ['2024-04-05', '2023-10-08'],
                8226: ['2024-04-05'],
                8228: ['2024-01-11', '2023-09-08', '2023-10-18', '2024-02-15', '2024-04-10', '2023-08-24', '2023-07-10', '2023-12-17', '2023-09-23', '2024-01-31', '2024-06-04'],
                8229: ['2023-07-05', '2024-02-15', '2023-09-08', '2023-08-14', '2024-06-04', '2024-02-15', '2024-01-31', '2024-03-21', '2024-02-05', '2023-08-24', '2023-08-19', '2024-04-25', '2024-05-10', '2024-04-10', '2023-09-23'],
                8230: ['2023-10-18', '2023-07-30', '2023-12-22', '2024-02-15', '2024-03-21', '2023-12-27', '2024-01-31', '2023-07-05', '2023-12-17', '2023-09-03', '2023-06-19', '2023-08-19', '2023-07-05', '2023-12-22', '2023-08-24'],
                8231: ['2023-10-08', '2023-08-24', '2023-10-08', '2023-08-14', '2024-04-25', '2024-06-04', '2024-04-05', '2023-07-05', '2023-07-10'],
                8282: ['2024-02-05', '2024-01-31', '2023-07-30', '2023-07-25', '2024-03-21', '2024-06-24', '2023-08-14', '2023-08-19', '2024-03-01', '2024-04-10', '2023-12-27']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/MNDWI/fusion_trait_de_cote_2024&2025.shp",
            "dates_a_supprimer": {
                8235: ['2025-06-29', '2025-05-05'],
                8236: ['2025-06-01', '2024-08-23', '2025-06-29', '2025-03-11', '2025-04-20', '2024-12-31', '2024-12-26', '2024-08-18'],
                8237: ['2025-04-20', '2024-11-11', '2025-06-01', '2024-08-23', '2024-08-18'],
                8238: ['2025-06-29', '2025-06-09'],
                8241: ['2024-12-31', '2025-02-14', '2024-12-06', '2024-11-11', '2024-11-06', '2024-09-22', '2025-07-01'],
                8242: ['2025-07-01', '2025-06-29'],
                8243: ['2025-03-06', '2025-06-04', '2025-06-29', '2024-11-11', '2024-11-16', '2024-08-23'],
                8244: ['2025-03-26', '2025-03-06', '2025-06-24', '2025-01-25'],
                8245: ['2025-03-26', '2025-03-06', '2025-01-25', '2025-06-24'],
                8247: ['2025-03-06', '2024-07-09'],
                8248: ['2025-03-26', '2025-06-01', '2025-06-09', '2025-03-06', '2024-11-11', '2024-10-17'],
                8249: ['2025-03-06', '2025-04-22', '2025-05-12', '2025-05-05', '2025-03-11', '2025-02-14'],
                8250: ['2025-06-24', '2025-06-24', '2024-12-31'],
                8251: ['2024-07-24'],
                8252: ['2024-12-31', '2024-07-24', '2025-04-15', '2025-05-20', '2025-07-01', '2025-04-10', '2025-03-06', '2025-05-25', '2024-10-17', '2025-06-29', '2024-12-26'],
                8253: ['2024-07-24', '2025-06-01', '2024-12-06', '2025-03-06', '2025-07-01', '2025-04-10', '2024-11-11', '2024-11-16', '2025-05-05', '2025-06-29', '2024-08-18', '2024-08-23', '2025-05-12', '2025-06-24', '2025-01-30', '2024-12-31', '2025-01-25', '2025-04-20', '2025-03-11'],
                8254: ['2025-04-20', '2024-07-24', '2024-08-08', '2025-06-09', '2025-06-01', '2024-11-16'],
                8255: ['2025-04-10', '2025-06-24', '2024-09-22', '2024-08-23'],
                8256: ['2024-07-24', '2025-06-24', '2025-01-05', '2024-08-08', '2025-04-10', '2025-06-01'],
                8257: ['2024-08-08', '2025-06-04', '2025-06-01', '2025-06-29', '2024-11-11', '2025-06-09', '2024-08-23', '2025-07-01', '2025-05-20', '2024-12-31', '2025-01-05', '2025-06-24', '2025-06-01', '2024-11-16', '2024-07-19', '2024-12-31'],
                8258: ['2025-07-01', '2025-01-05', '2024-11-06', '2024-12-31'],
                8259: ['2024-08-08', '2025-01-25'],
                8260: ['2025-04-20', '2025-06-24', '2025-06-29', '2025-03-06', '2025-04-22', '2025-03-26', '2024-09-22', '2025-06-01', '2025-01-25'],
                8261: ['2025-01-15', '2025-01-30', '2025-04-22', '2025-03-11', '2025-06-04'],
                8262: ['2025-01-15', '2024-07-24', '2025-03-06', '2025-01-05', '2024-12-31', '2024-08-18', '2025-01-30'],
                8263: ['2025-01-05', '2024-12-31', '2024-07-24', '2024-11-16', '2025-06-09', '2024-07-24', '2025-06-01', '2025-06-04', '2024-10-17', '2025-03-06', '2025-04-15', '2023-07-25'],
                8264: ['2025-03-06'],
                8265: ['2024-11-16', '2025-05-25', '2025-01-05', '2025-01-30', '2024-08-23', '2024-12-31', '2025-06-01', '2024-07-19', '2025-01-30', '2025-05-25', '2025-07-01', '2024-11-16', '2024-07-19'],
                8266: ['2024-12-31', '2024-07-29', '2024-10-17', '2024-08-18', '2025-03-06', '2025-03-26', '2025-03-06'],
                8269: ['2024-09-22', '2025-03-06', '2024-07-24', '2025-06-09', '2024-08-23', '2024-07-24', '2025-01-25', '2025-01-30', '2024-08-23', '2024-08-08', '2025-01-15', '2025-04-05', '2025-05-25'],
                8270: ['2024-09-22', '2024-08-23', '2025-04-10', '2024-07-24', '2025-01-25', '2025-01-30', '2025-03-06', '2025-06-04'],
                8273: ['2025-01-25', '2025-03-06', '2025-01-30', '2025-01-15', '2025-05-30', '2025-03-06', '2024-08-18', '2024-07-09', '2025-06-24', '2025-05-05'],
                8274: ['2025-01-15', '2025-01-25', '2025-03-06', '2025-04-05', '2024-08-13', '2025-05-25', '2024-08-18', '2025-05-20', '2024-08-13', '2025-03-26', '2025-01-30', '2024-11-16'],
                8275: ['2024-08-23', '2025-03-26', '2024-08-18', '2025-04-20', '2025-06-04', '2025-04-20', '2024-11-11', '2024-08-23', '2025-05-25', '2025-06-24', '2024-12-31', '2025-03-26', '2024-08-13', '2024-12-31', '2025-01-30', '2025-01-15', '2025-01-30', '2025-05-20'],
                8276: ['2024-12-31', '2024-11-16', '2025-06-04', '2024-08-13', '2024-08-18', '2025-05-20', '2025-03-06', '2025-06-29', '2025-01-30', '2025-01-15', '2025-01-25'],
                8223: ['2024-10-17', '2025-06-04', '2024-07-19', '2025-03-06'],
                8225: ['2024-07-29'],
                8228: ['2025-04-10', '2024-09-22', '2024-07-24', '2025-02-14', '2025-01-15', '2025-05-12'],
                8229: ['2024-07-09', '2025-02-14', '2025-01-25', '2024-10-17', '2025-04-10', '2025-05-25', '2025-04-15', '2025-05-25', '2025-06-04', '2025-05-30', '2025-04-20', '2025-05-20', '2025-05-12', '2025-06-24', '2024-09-22', '2024-08-13', '2024-07-09', '2024-12-31'],
                8230: ['2025-02-14', '2025-05-20', '2024-07-19', '2024-08-23', '2025-05-12', '2024-10-17', '2025-04-15', '2025-04-10', '2024-11-06', '2025-06-09', '2025-06-24', '2024-07-09', '2024-08-08'],
                8231: ['2024-12-31', '2025-04-10'],
                8232: ['2025-01-05'],
                8282: ['2025-01-30', '2025-06-29', '2025-04-20', '2025-02-14', '2025-04-10']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/NDWI/fusion_trait_de_cote_2015&2017.shp",
            "dates_a_supprimer": {
                8192: ['2017-04-12', '2016-06-16', '2016-06-06'],
                8195: ['2017-05-12'],
                8202: ['2016-05-27', '2016-06-06'],
                8203: ['2016-07-16', '2016-06-06'],
                8204: ['2016-07-16', '2016-06-16', '2016-03-28'],
                8206: ['2016-06-16', '2016-06-06', '2017-06-26', '2017-03-03', '2016-04-17', '2016-10-14', '2017-02-11'],
                8207: ['2016-06-06', '2016-08-25', '2016-03-28', '2017-06-11', '2017-05-12', '2016-07-06', '2016-07-16'],
                8208: ['2016-10-14', '2016-04-17', '2016-06-06', '2016-12-13', '2017-03-03'],
                8209: ['2017-05-12', '2016-12-23', '2016-06-06'],
                8211: ['2017-05-12', '2016-06-06', '2016-06-26'],
                8215: ['2016-06-26'],
                8217: ['2017-06-26', '2016-06-06'],
                8218: ['2016-06-26', '2016-07-26', '2016-06-06', '2017-06-26'],
                8219: ['2017-06-26', '2017-03-03', '2016-10-04', '2016-10-14'],
                8221: ['2016-12-13', '2017-06-21'],
                8227: ['2016-06-06'],
                8233: ['2017-05-12', '2016-12-13', '2016-03-28', '2017-03-03', '2016-04-07', '2016-10-04', '2016-04-17', '2015-11-29', '2016-07-26', '2016-08-25', '2016-06-06', '2016-06-26', '2016-12-13', '2016-07-26', '2016-10-14', '2016-07-16'],
                8234: ['2016-06-06'],
                8280: ['2016-06-06', '2016-08-25', '2016-05-27', '2016-03-28', '2017-02-11', '2017-04-12', '2017-03-03', '2016-07-26']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/NDWI/fusion_trait_de_cote_2017&2018.shp",
            "dates_a_supprimer": {
                8192: ['2017-09-24'],
                8193: ['2017-07-21'],
                8194: ['2017-07-21'],
                8195: ['2017-10-09', '2018-05-17', '2017-07-21'],
                8196: ['2018-05-17', '2017-07-21', '2018-06-26', '2018-04-12'],
                8197: ['2017-07-21'],
                8199: ['2018-04-12'],
                8200: ['2018-02-01'],
                8202: ['2017-07-21'],
                8204: ['2017-07-21', '2017-11-03', '2018-01-22'],
                8206: ['2017-07-21', '2018-02-01', '2017-08-05', '2017-11-03', '2017-07-11', '2018-06-11', '2017-11-18', '2017-07-06', '2018-06-01'],
                8207: ['2018-01-22', '2018-03-13', '2017-07-21', '2017-09-24', '2018-01-22'],
                8208: ['2017-11-28', '2017-10-09', '2017-07-11', '2017-07-21'],
                8209: ['2018-01-22', '2017-11-03', '2017-07-21'],
                8210: ['2017-07-21', '2017-08-15', '2017-11-28'],
                8211: ['2017-12-08', '2017-07-21'],
                8216: ['2018-01-02'],
                8219: ['2018-01-22', '2017-12-23'],
                8221: ['2017-11-13', '2018-06-26', '2017-11-18'],
                8222: ['2017-07-21'],
                8227: ['2017-08-25', '2018-06-16', '2018-04-16'],
                8233: ['2017-11-18', '2017-09-09', '2018-06-26', '2017-07-06', '2018-04-02', '2018-01-02', '2018-04-07', '2018-03-28', '2017-12-23', '2017-10-09', '2017-09-04', '2017-11-03', '2017-07-21'],
                8234: ['2017-08-25', '2017-11-18', '2017-08-25', '2017-10-09', '2018-02-01', '2017-09-24'],
                8280: ['2017-08-25', '2017-09-09', '2017-07-11', '2017-12-23', '2018-08-11', '2017-11-28', '2017-10-09', '2018-02-11']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/NDWI/fusion_trait_de_cote_2018&2019.shp",
            "dates_a_supprimer": {
                8193: ['2019-03-03', '2019-04-27'],
                8195: ['2019-06-11', '2018-07-16'],
                8202: ['2019-02-11'],
                8203: ['2019-03-03', '2018-07-16', '2019-06-21', '2019-05-02'],
                8204: ['2018-07-16', '2018-10-14', '2019-02-21'],
                8205: ['2019-06-21', '2018-11-08'],
                8206: ['2018-11-08', '2019-05-02', '2018-08-05', '2018-07-16', '2018-12-18', '2018-11-28'],
                8207: ['2018-07-31', '2018-07-16', '2018-09-29', '2018-10-14', '2018-11-03', '2018-12-03'],
                8208: ['2019-02-21', '2018-11-08'],
                8209: ['2019-02-21', '2019-06-01', '2019-05-02'],
                8211: ['2018-07-31', '2018-09-29', '2018-07-16'],
                8216: ['2018-12-28'],
                8217: ['2019-02-21'],
                8219: ['2018-07-16', '2019-03-03', '2018-09-29', '2018-11-28', '2019-06-21'],
                8221: ['2018-07-16', '2019-06-21', '2019-03-28', '2018-11-03'],
                8222: ['2018-07-16'],
                8233: ['2018-12-03', '2018-07-16', '2018-07-11', '2019-03-13', '2018-11-03', '2018-08-25', '2018-09-29', '2018-11-08', '2019-06-01', '2019-06-01'],
                8234: ['2018-07-16'],
                8280: ['2019-05-12', '2018-10-14', '2019-03-13', '2019-06-21', '2018-12-13', '2018-07-16', '2019-06-11', '2018-12-08', '2018-12-03']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/NDWI/fusion_trait_de_cote_2019&2020.shp",
            "dates_a_supprimer": {
                8192: ['2019-07-11', '2020-01-12', '2019-09-29'],
                8193: ['2019-10-24', '2019-11-08', '2019-08-15', '2020-04-06', '2020-06-15'],
                8194: ['2019-08-05', '2020-04-26'],
                8195: ['2019-07-11', '2019-11-08'],
                8196: ['2019-07-11', '2019-11-08', '2019-08-15'],
                8197: ['2019-07-11', '2019-11-08'],
                8198: ['2019-07-11'],
                8200: ['2020-05-06'],
                8205: ['2019-07-11'],
                8206: ['2019-07-11', '2019-08-10', '2019-07-01', '2019-08-05', '2020-06-15', '2020-04-26'],
                8207: ['2019-07-01', '2019-08-05', '2020-05-31', '2019-11-08'],
                8208: ['2020-04-26', '2019-08-10', '2019-10-04'],
                8209: ['2020-06-15'],
                8211: ['2019-07-11', '2020-04-26', '2019-08-05'],
                8215: ['2019-08-05', '2019-08-15', '2019-07-11'],
                8216: ['2019-08-05', '2019-08-15', '2019-07-11', '2019-08-10'],
                8219: ['2020-01-12'],
                8221: ['2019-07-01', '2019-07-11', '2020-06-15'],
                8227: ['2020-03-22', '2020-04-26', '2019-08-15', '2019-08-05'],
                8233: ['2019-12-03', '2020-04-01', '2020-03-22', '2020-01-12', '2020-04-06', '2020-01-27', '2019-10-14', '2019-09-29', '2020-02-01', '2019-10-29', '2019-12-18', '2019-10-04'],
                8280: ['2020-06-30', '2019-08-10', '2020-04-26', '2020-04-16', '2019-10-04', '2019-11-03', '2019-08-05', '2020-05-06']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/NDWI/fusion_trait_de_cote_2020&2021.shp",
            "dates_a_supprimer": {
                8192: ['2021-04-06', '2021-06-30', '2021-06-20', '2021-01-16'],
                8193: ['2021-02-20'],
                8199: ['2021-06-20'],
                8201: ['2020-08-19', '2021-06-20', '2021-06-30', '2020-07-10'],
                8202: ['2021-06-20', '2021-06-30', '2021-07-10'],
                8203: ['2021-06-20', '2021-06-30'],
                8204: ['2021-06-20', '2021-06-30', '2021-03-12'],
                8206: ['2020-12-22', '2020-09-23', '2020-08-29', '2021-06-20', '2021-06-30', '2020-10-18', '2021-04-01', '2021-03-17', '2020-07-10', '2020-12-07', '2021-02-10', '2021-01-26'],
                8207: ['2021-06-30'],
                8208: ['2020-09-23'],
                8209: ['2020-10-08', '2021-03-02', '2021-02-10', '2021-02-30'],
                8211: ['2021-02-20', '2021-03-17'],
                8216: ['2021-06-20'],
                8219: ['2021-06-20', '2021-06-30', '2021-03-12', '2021-01-01'],
                8221: ['2021-05-31'],
                8222: ['2020-10-08', '2021-06-20', '2021-06-30'],
                8227: ['2021-05-31'],
                8233: ['2021-04-06', '2021-03-12', '2020-09-23', '2020-09-08', '2021-03-02', '2021-01-01', '2020-12-22'],
                8234: ['2021-06-30', '2020-08-19', '2021-03-12', '2021-06-25'],
                8280: ['2021-05-11', '2021-05-01', '2021-03-22', '2021-05-31', '2021-02-20', '2021-03-17', '2021-06-30', '2020-08-19', '2020-12-07', '2021-01-01', '2020-12-12', '2021-06-30', '2020-07-10']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/NDWI/fusion_trait_de_cote_2021&2022.shp",
            "dates_a_supprimer": {
                8195: ['2022-04-11', '2022-04-26', '2021-09-18'],
                8199: ['2022-05-26', '2022-04-26', '2021-10-28'],
                8201: ['2022-04-26'],
                8202: ['2022-04-26'],
                8204: ['2021-08-14'],
                8206: ['2022-01-26', '2022-06-30', '2022-02-15', '2021-10-18', '2022-03-12', '2022-04-26', '2022-02-10', '2021-07-15', '2021-07-20'],
                8207: ['2021-09-18', '2022-06-30', '2022-06-05'],
                8208: ['2022-02-10', '2021-10-18', '2022-04-11', '2021-11-07', '2021-10-23', '2021-12-17', '2022-04-11'],
                8209: ['2021-12-17'],
                8210: ['2021-12-17'],
                8211: ['2021-09-08', '2022-04-26', '2022-02-15', '2021-12-17'],
                8215: ['2021-09-08'],
                8216: ['2021-12-17', '2022-04-26'],
                8219: ['2022-04-11'],
                8221: ['2021-07-15', '2022-02-10', '2021-09-28'],
                8233: ['2021-08-14', '2022-02-15', '2022-03-12', '2021-09-18', '2021-10-23', '2022-01-26', '2021-10-18'],
                8234: ['2022-05-21', '2021-07-15'],
                8280: ['2021-08-14', '2021-07-15', '2022-05-21', '2021-09-08', '2022-04-21', '2021-09-28', '2021-11-07']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/NDWI/fusion_trait_de_cote_2022&2023.shp",
            "dates_a_supprimer": {
                8195: ['2022-08-24', '2023-02-10'],
                8196: ['2023-01-01'],
                8197: ['2023-01-01'],
                8198: ['2023-01-01'],
                8199: ['2023-01-01'],
                8200: ['2023-01-01'],
                8202: ['2023-04-21'],
                8204: ['2023-01-01', '2023-04-06', '2023-04-21', '2023-02-10', '2022-09-23'],
                8205: ['2023-01-01'],
                8206: ['2023-01-01', '2023-03-27', '2023-12-17', '2022-12-17', '2023-04-21'],
                8207: ['2023-02-25', '2023-05-11'],
                8208: ['2022-11-07', '2022-08-24', '2023-06-30', '2023-01-01'],
                8210: ['2023-06-30'],
                8211: ['2023-01-01', '2023-06-30'],
                8215: ['2022-07-05', '2023-04-21'],
                8216: ['2023-06-30', '2023-04-21'],
                8217: ['2023-01-01', '2023-04-21'],
                8218: ['2023-04-06', '2022-07-25', '2022-07-10', '2023-04-21', '2023-05-21', '2022-11-17', '2023-02-25', '2023-05-11'],
                8219: ['2023-06-30'],
                8220: ['2023-04-21'],
                8221: ['2023-01-01', '2022-08-09'],
                8227: ['2023-05-11', '2023-01-01', '2023-04-21'],
                8233: ['2022-10-03', '2022-08-24', '2023-03-27', '2022-11-07', '2023-04-06', '2023-05-11', '2023-02-10', '2022-07-05', '2023-04-21', '2023-04-21'],
                8280: ['2022-07-05', '2023-05-11', '2022-12-27', '2023-02-10', '2023-06-10', '2023-01-01', '2022-12-07', '2022-10-03', '2022-07-25', '2022-11-27', '2022-10-08', '2023-05-11', '2022-12-03']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/NDWI/fusion_trait_de_cote_2023&2024.shp",
            "dates_a_supprimer": {
                8192: ['2023-09-23'],
                8193: ['2023-08-09'],
                8194: ['2024-04-05'],
                8295: ['2024-04-05', '2024-04-05'],
                8197: ['2024-06-04', '2024-05-05'],
                8203: ['2023-10-18'],
                8204: ['2024-05-05'],
                8206: ['2023-08-14', '2024-03-01', '2024-06-19', '2024-06-04', '2023-09-08', '2023-10-23', '2023-07-30', '2023-08-24', '2024-05-05'],
                8207: ['2024-05-05'],
                8211: ['2023-12-17'],
                8215: ['2024-03-01', '2023-08-14', '2024-06-09', '2023-09-03'],
                8216: ['2023-08-24', '2024-05-05'],
                8217: ['2023-08-14'],
                8219: ['2024-02-05', '2023-09-08', '2023-10-08', '2023-08-19'],
                8220: ['2023-08-24'],
                8221: ['2024-03-21', '2023-09-08', '2024-06-04', '2024-01-31', '2023-07-05'],
                8233: ['2023-08-09', '2024-04-05', '2024-03-21', '2024-01-11', '2024-02-05', '2024-03-01', '2023-09-03', '2023-10-08', '2024-02-15', '2023-07-30'],
                8234: ['2023-07-30', '2023-08-19', '2024-02-15'],
                8280: ['2023-08-09', '2023-07-25', '2024-06-09', '2023-09-03', '2024-06-24', '2024-05-10', '2024-01-11', '2024-06-24', '2024-02-05']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/NDWI/fusion_trait_de_cote_2024&2025.shp",
            "dates_a_supprimer": {
                8192: ['2025-07-01', '2025-06-01'],
                8193: ['2024-08-23'],
                8195: ['2024-08-18', '2025-03-06', '2024-08-13', '2025-05-30'],
                8197: ['2025-01-05'],
                8198: ['2025-06-24', '2025-01-05'],
                8200: ['2024-08-13', '2024-12-26', '2024-08-18'],
                8202: ['2025-05-30', '2025-06-01', '2025-06-29'],
                8203: ['2024-08-13', '2025-05-30'],
                8204: ['2025-01-05', '2024-08-18'],
                8205: ['2024-08-18'],
                8206: ['2025-06-01', '2025-06-29', '2025-05-30', '2025-06-09', '2025-04-05', '2025-04-10', '2024-09-22', '2024-08-08', '2024-12-31', '2024-07-19', '2025-03-11', '2025-03-06'],
                8207: ['2025-06-01', '2025-06-29', '2025-04-05', '2024-08-18'],
                8208: ['2025-03-26', '2024-08-13', '2025-01-15', '2024-12-31', '2025-03-06', '2024-11-11', '2024-11-16', '2025-06-01'],
                8209: ['2024-11-16', '2025-01-05', '2025-06-01'],
                8215: ['2025-05-25', '2024-08-18', '2025-06-04', '2025-04-20', '2025-04-15'],
                8216: ['2025-07-01', '2025-05-30', '2025-06-01'],
                8217: ['2025-01-30', '2025-03-06'],
                8218: ['2024-08-18', '2025-01-30', '2025-03-11', '2024-09-22', '2025-05-25', '2024-07-19', '2025-06-04'],
                8219: ['2025-06-04', '2024-07-29'],
                8221: ['2025-06-01', '2024-08-08', '2024-08-13', '2025-05-12', '2025-06-29', '2025-04-20', '2025-01-05', '2025-05-30', '2024-11-16'],
                8222: ['2025-06-01', '2025-03-26'],
                8227: ['2025-05-20', '2024-08-23', '2025-06-29', '2025-05-30', '2024-07-09'],
                8233: ['2025-01-05', '2025-06-01', '2025-03-26', '2025-04-20', '2024-12-26', '2026-02-14', '2025-05-12', '2025-01-05', '2025-06-29', '2025-02-14'],
                8234: ['2025-01-05', '2025-06-29', '2024-07-09', '2025-06-29'],
                8280: ['2025-06-01', '2025-05-30', '2025-06-29', '2024-07-09', '2025-03-06', '2025-01-05', '2024-07-24', '2025-06-09', '2024-08-23', '2025-05-30', '2024-12-06', '2024-11-06', '2025-04-10']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEINSH/fusion_trait_de_cote_2015&2017.shp",
            "dates_a_supprimer": {
                8224: ['2017-06-21', '2016-05-27', '2017-06-26', '2016-10-14', '2017-06-11', '2016-03-28', '2015-11-29', '2016-03-28', '2015-10-20', '2016-12-23'],
                8267: ['2017-06-21', '2017-06-21', '2016-06-06', '2016-04-17', '2017-05-22', '2016-03-28'],
                8271: ['2015-11-29', '2016-10-14', '2016-12-23', '2016-04-17', '2016-12-13', '2016-04-17', '2017-04-12', '2017-02-11', '2016-06-06', '2017-06-21'],
                8272: ['2016-07-26', '2016-06-26'],
                8277: ['2016-12-23', '2016-04-17', '2016-06-26', '2017-05-12', '2017-05-12', '2016-07-06', '2017-03-03', '2016-03-28', '2017-02-11', '2017-06-21', '2016-06-06', '2016-08-25', '2016-07-16'],
                8278: ['2017-03-03', '2017-05-12', '2016-12-23', '2015-11-29', '2016-06-26', '2017-07-06'],
                8279: ['2017-05-12', '2016-06-16']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEINSH/fusion_trait_de_cote_2017&2018.shp",
            "dates_a_supprimer": {
                8224: ['2017-07-11', '2018-06-21', '2017-08-05', '2017-07-11', '2017-11-03', '2017-12-08', '2018-02-01', '2017-11-28', '2018-06-26', '2017-12-23'],
                8267: ['2018-06-01', '2017-09-04', '2017-08-15', '2018-02-01', '2018-05-17', '2017-07-21', '2017-09-24', '2017-11-28', '2017-07-06', '2017-08-15', '2017-07-21', '2018-03-13'],
                8271: ['2017-07-21', '2017-11-28', '2018-05-17'],
                8277: ['2018-02-11', '2017-11-28', '2017-10-09', '2017-09-04', '2018-02-11', '2018-02-01', '2018-04-12', '2018-03-13', '2018-01-02', '2017-09-04', '2018-05-17', '2017-07-06', '2017-11-28', '2017-07-21', '2018-01-22'],
                8278: ['2017-10-09', '2017-07-21'],
                8279: ['2018-02-01']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEINSH/fusion_trait_de_cote_2018&2019.shp",
            "dates_a_supprimer": {
                8224: ['2018-11-28', '2019-06-16', '2018-09-19', '2018-12-28', '2019-01-12', '2019-02-11', '2018-10-14', '2018-12-08', '2018-11-03', '2018-11-03', '2018-08-05', '2018-10-14', '2019-02-11', '2018-08-10', '2019-05-12'],
                8267: ['2019-05-27', '2018-08-05', '2018-07-16', '2018-12-18', '2018-12-13', '2018-07-31', '2018-10-14', '2018-12-08', '2019-06-01', '2018-12-03', '2019-04-27', '2018-07-11', '2018-07-06'],
                8271: ['2018-11-28', '2019-01-12', '2019-05-02', '2019-03-03', '2019-06-01', '2018-12-18', '2019-02-21', '2018-12-13', '2018-12-03', '2018-08-05', '2018-11-08'],
                8277: ['2018-08-05', '2018-12-13', '2018-12-18', '2018-07-31', '2018-12-03', '2018-10-14', '2018-07-11', '2018-08-30', '2018-11-08', '2018-09-19', '2018-12-08'],
                8278: ['2018-11-08', '2018-12-08', '2018-07-16', '2019-01-12', '2018-12-08', '2019-03-03'],
                8279: ['2019-03-03', '2018-10-14', '2019-02-11', '2018-07-16', '2018-11-08', '2018-12-08', '2018-11-03', '2018-10-14', '2019-05-12']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEINSH/fusion_trait_de_cote_2019&2020.shp",
            "dates_a_supprimer": {
                8224: ['2019-12-18', '2020-06-15', '2019-09-29', '2019-10-29', '2019-12-03'],
                8267: ['2019-09-29', '2020-04-26', '2019-08-15', '2019-12-13', '2019-12-03', '2019-08-15', '2019-07-01', '2019-08-10'],
                8271: ['2020-01-12', '2020-03-22', '2020-04-26', '2020-06-15', '2020-06-30', '2020-04-01', '2020-05-31'],
                8272: ['2020-03-22', '2019-07-01'],
                8277: ['2020-03-22', '2019-10-04', '2019-12-13', '2020-03-22', '2019-12-18', '2019-12-03'],
                8279: ['2019-10-29', '2020-05-06']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEINSH/fusion_trait_de_cote_2020&2021.shp",
            "dates_a_supprimer": {
                8224: ['2020-12-07', '2021-03-02', '2021-06-10', '2020-08-19', '2020-09-23', '2020-10-08', '2020-08-24', '2020-12-22', '2020-11-02', '2021-05-31'],
                8267: ['2021-01-06', '2021-04-06', '2020-10-08', '2020-12-22', '2020-08-19', '2021-05-01', '2020-12-12', '2021-06-30', '2021-02-10', '2020-12-22', '2021-03-22', '2021-05-31', '2021-01-26'],
                8271: ['2020-12-07', '2021-01-16', '2021-05-01', '2021-03-12', '2021-05-31', '2020-10-08', '2021-05-01'],
                8277: ['2020-12-07', '2020-12-22', '2020-11-02', '2021-01-16', '2021-06-20', '2021-04-01'],
                8278: ['2020-08-24', '2021-01-16', '2021-04-01'],
                8279: ['2020-09-08', '2021-01-16', '2020-10-18', '2021-01-01']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEINSH/fusion_trait_de_cote_2021&2022.shp",
            "dates_a_supprimer": {
                8224: ['2022-06-05', '2021-11-17', '2022-06-05', '2022-04-21'],
                8267: ['2021-12-17', '2022-04-21', '2021-09-18', '2021-10-28', '2022-01-26', '2021-08-14', '2022-05-01'],
                8271: ['2021-10-18', '2022-05-01', '2021-09-18', '20227-01-26', '2021-07-05'],
                8277: ['2022-05-05', '2022-05-06', '2022-02-10'],
                8278: ['2022-05-06', '2022-04-21']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEINSH/fusion_trait_de_cote_2022&2023.shp",
            "dates_a_supprimer": {
                8224: ['2022-07-10', '2023-04-21', '2023-06-30', '2022-11-07', '2023-04-16', '2022-12-02', '2022-08-09', '2022-12-17', '2023-01-01'],
                8267: ['2022-08-09', '2023-05-01', '2023-01-16', '2022-12-07', '2023-05-21', '2023-01-01', '2022-12-02', '2022-11-27'],
                8271: ['2023-01-01', '2023-04-16', '2023-04-21', '2023-03-02', '2023-05-21', '2023-05-01', '2023-02-10'],
                8272: ['2023-01-01', '2023-04-21'],
                8277: ['2023-01-01', '2023-01-16'],
                8278: ['2023-01-01'],
                8279: ['2023-01-01']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEINSH/fusion_trait_de_cote_2023&2024.shp",
            "dates_a_supprimer": {
                8224: ['2024-05-10', '2024-06-24', '2024-04-05', '2024-02-15', '2024-04-05', '2024-06-04', '2023-08-09'],
                8267: ['2024-01-11'],
                8271: ['2024-02-05', '2023-07-10', '2023-08-14', '2024-04-05', '2023-09-23', '2024-05-10', '2023-12-17', '2023-07-25'],
                8272: ['2024-03-21'],
                8277: ['2024-05-10', '2024-02-15', '2024-04-10', '2024-05-05', '2024-06-04', '2024-06-19', '2024-04-25'],
                8278: ['2024-06-19', '2023-08-14', '2023-10-18', '2024-05-10', '2024-04-05', '2024-02-15', '2024-05-05'],
                8279: ['2023-08-24', '2023-09-08', '2023-07-05', '2023-08-14']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEINSH/fusion_trait_de_cote_2024&2025.shp",
            "dates_a_supprimer": {
                8224: ['2025-06-09', '2024-07-29', '2024-11-11', '2024-12-26', '2024-12-26'],
                8267: ['2024-12-06', '2024-12-31', '2025-06-24', '2024-07-29'],
                8271: ['2025-04-15', '2024-08-13', '2024-11-06', '2025-03-26', '2025-01-05', '2024-11-15', '2025-04-20', '2025-01-15', '2025-06-24', '2025-04-10', '2025-04-22', '2024-07-09', '2024-11-11', '2024-12-31', '2025-05-30', '2024-11-16', '2025-06-09'],
                8277: ['2025-01-15', '2024-08-13', '2025-01-25', '2024-06-19', '2025-06-29', '2024-08-18'],
                8278: ['2024-11-16', '2024-08-08', '2025-05-12', '2025-03-26', '2024-07-29', '2024-08-13', '2024-11-11', '2024-08-18', '2025-01-17', '2025-01-15'],
                8279: ['2024-11-16', '2025-06-04', '2024-08-18', '2024-07-29', '2025-06-29', '2025-02-14']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEISH/fusion_trait_de_cote_2015&2017.shp",
            "dates_a_supprimer": {
                8212: ['2016-06-06', '2017-06-21', '2017-06-11', '2016-06-26', '2017-07-16', '2017-03-03', '2017-06-01'],
                8213: ['2016-10-04', '2016-12-13', '2016-07-16'],
                8281: ['2017-06-21', '2016-05-27', '2017-06-26'],
                8211: ['2016-07-16']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEISH/fusion_trait_de_cote_2017&2018.shp",
            "dates_a_supprimer": {
                8212: ['2017-08-10', '2017-11-28', '2018-01-02', '2018-06-16'],
                8213: ['2018-01-02', '2018-05-17'],
                8214: ['2017-11-18', '2018-01-22', '2017-11-18']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEISH/fusion_trait_de_cote_2018&2019.shp",
            "dates_a_supprimer": {
                8212: ['2018-11-28', '2019-06-01', '2019-05-12', '2019-05-02', '2019-06-11', '2018-07-06', '2018-07-16'],
                8213: ['2018-07-16'],
                8214: ['2018-12-28', '2018-12-18', '2018-07-16', '2019-03-03'],
                8281: ['2019-05-27', '2018-07-11', '2019-06-16', '2018-07-16', '2019-06-01', '2019-01-12', '2019-06-01', '2019-03-03', '2019-03-13'],
                8211: ['2018-07-06', '2018-07-16']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEISH/fusion_trait_de_cote_2019&2020.shp",
            "dates_a_supprimer": {
                8212: ['2020-07-01', '2020-01-27', '2020-04-16', '2020-03-22', '2019-03-01', '2019-12-03', '2019-07-11', '2020-04-01', '2019-07-01', '2019-08-05'],
                8213: ['2020-04-01', '2019-07-11', '2020-04-26', '2019-11-08', '2019-08-15'],
                8214: ['2019-11-08', '2020-04-26', '2020-07-06', '2020-05-06'],
                8281: ['2020-06-15', '2019-07-01', '2019-12-13', '2020-05-06', '2019-08-10', '2019-12-13', '2020-06-15', '2019-07-11']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEISH/fusion_trait_de_cote_2020&2021.shp",
            "dates_a_supprimer": {
                8212: ['2021-02-20', '2021-04-01', '2020-07-10', '2021-05-01', '2021-02-25', '2020-08-24', '2021-04-06', '2021-01-01', '2021-06-30', '2021-03-12', '2021-05-21'],
                8213: ['2021-06-30', '2021-03-12', '2021-06-10', '2021-02-25', '2020-08-24'],
                8214: ['2021-06-30', '2021-03-12', '2020-12-22'],
                8281: ['2021-06-10', '2020-07-10', '2021-04-06', '2021-05-26', '2021-02-20', '2021-04-06'],
                8211: ['2021-03-12', '2021-06-30']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEISH/fusion_trait_de_cote_2021&2022.shp",
            "dates_a_supprimer": {
                8212: ['2021-09-28', '2021-12-17', '2021-09-18', '2021-08-14', '2022-05-21', '2021-09-18', '2022-06-05', '2022-05-06', '2021-07-15', '2021-07-05', '2021-11-07', '2022-05-31'],
                8213: ['2022-03-12', '2021-07-13', '2022-06-05'],
                8214: ['2021-02-17', '2022-02-15', '2021-11-07', '2021-12-17'],
                8281: ['2022-05-26', '2021-09-08'],
                8211: ['2021-12-17']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEISH/fusion_trait_de_cote_2022&2023.shp",
            "dates_a_supprimer": {
                8212: ['2022-09-23', '2023-05-21', '2023-06-30', '2023-06-10', '2020-04-21', '2022-12-02', '2023-05-01', '2023-04-21'],
                8213: ['2023-04-21', '2023-06-10'],
                8281: ['2023-01-01'],
                8211: ['2023-04-21']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEISH/fusion_trait_de_cote_2023&2024.shp",
            "dates_a_supprimer": {
                8212: ['2024-06-09', '2024-02-05', '2023-10-18', '2024-04-10', '2023-10-23', '2024-03-21', '2023-07-25', '2024-04-05'],
                8213: ['2023-07-30', '2023-08-14', '2023-10-18', '2023-07-05', '2023-06-24', '2023-12-17', '2024-05-05', '2023-08-19'],
                8214: ['2023-08-19', '2023-10-08', '2023-12-17', '2023-07-30'],
                8281: ['2023-08-09', '2023-08-14', '2023-07-10', '2023-07-05', '2023-07-25'],
                8211: ['2024-02-05', '2024-03-01']
            }
        },

        {
            "input": "/media/jonathan/Expansion/TDC/Fusion/AWEISH/fusion_trait_de_cote_2024&2025.shp",
            "dates_a_supprimer": {
                8212: ['2025-07-01', '2025-05-12', '2025-04-20', '2024-09-22', '2025-03-11', '2025-01-05'],
                8213: ['2025-03-06', '2024-08-18', '2025-06-24', '2025-03-11'],
                8214: ['2024-08-08', '2024-08-18', '2025-05-25', '2025-03-06'],
                8281: ['2025-06-01', '2025-06-29', '2025-06-04', '2024-07-24']
            }
        }
    ]

    for traitement in traitements:
        current_step = 1
        input_path = traitement["input"]
        dates_a_supprimer = traitement["dates_a_supprimer"]

        print(f"\n---- Traitement du fichier : {input_path} ----")

        show_progress(current_step, total_steps, "Chargement du shapefile")
        gdf = gpd.read_file(input_path)

        show_progress(current_step, total_steps, "Preprocessing - Projection & date format")
        gdf = preprocess_gdf(gdf, epsg_reunion)
        current_step += 1

        show_progress(current_step, total_steps, "Suppression des traits selon beach_code/dates")
        for bc, dates in dates_a_supprimer.items():
            if dates:
                dates_dt = pd.to_datetime(dates, errors='coerce')
                mask = (gdf['BEACH_CODE'] == bc) & (gdf['DATE'].isin(dates_dt))
                gdf = gdf[~mask]
        gdf = gdf.reset_index(drop=True)
        current_step += 1

        show_progress(current_step, total_steps, "Jointure avec données marées (REFMAR)")
        json_data = charger_json('/media/jonathan/Expansion/TDC/combined_marees_2015_2025.json')
        if json_data is None:
            logger.error("Arrêt du programme : fichier JSON marées introuvable ou illisible")
            continue

        df_marees = pd.DataFrame(json_data['data'])
        df_marees['timestamp'] = pd.to_datetime(df_marees['timestamp'], format='%Y/%m/%d %H:%M:%S', errors='coerce').astype('datetime64[ns]')
        gdf['DATE'] = pd.to_datetime(gdf['DATE'], errors='coerce').astype('datetime64[ns]')

        df_marees = classification_marree(df_marees)

        gdf = merge_marrees(gdf, df_marees)

        # Suppression des colonnes inutiles
        colonnes_a_supprimer = ['idstation', 'idsource']

        # Vérifier que ces colonnes existent avant suppression pour éviter les erreurs
        colonnes_existantes = [col for col in colonnes_a_supprimer if col in gdf.columns]

        if colonnes_existantes:
            gdf.drop(columns=colonnes_existantes, inplace=True)

        current_step += 1

        show_progress(current_step, total_steps, "Jointure avec données houles (CANDHIS)")

        gdf = merge_candhis(gdf, "/media/jonathan/Expansion/TDC/candhis_fusion.csv")

        current_step += 1

        show_progress(current_step, total_steps, "Sauvegarde fichier corrigé")
        output_path = get_output_path(input_path)
        os.makedirs(os.path.dirname(output_path), exist_ok=True)

        logger.info("Enregistrer sous forme Shapefile")

        gdf.to_file(output_path)
        print(f"Fichier corrigé sauvegardé : {output_path}")

        logger.info("Enregistrer sous forme GeoJSON")

        geojson_output = os.path.splitext(output_path)[0] + '.geojson'
        gdf.to_file(geojson_output, driver="GeoJSON")
        print(f"Fichier GeoJSON sauvegardé : {geojson_output}")

        show_progress(total_steps, total_steps, "Traitement terminé")

if __name__ == "__main__":
    main()
